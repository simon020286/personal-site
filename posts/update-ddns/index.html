<!doctype html><html lang=it-it><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Update Ddns | Dev Daddy</title><meta name=description content="Dev Daddy blog."><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="all,follow"><meta name=googlebot content="index,follow,snippet,archive"><meta property="og:title" content="Update Ddns"><meta property="og:description" content="Eccoci qui con il primo vero post di questo blog.
Oggi ci dedicheremo all&rsquo;aggiornamento automatico dell&rsquo;ip del proprio server su alcuni servizi DDNS.
Per fare ciò esistono innumerevoli tool, ma perché utilizzare qualcosa di già fatto quando puoi imparare qualcosa di nuovo?
In questo periodo mi sto dilettando con gli script bash, quindi ho deciso di seguire questa strada. Il progetto è composto da soli due file, lo script vero e proprio e il file di configurazione, ad essere precisi ce ne sarebbe un terzo, ma viene creato automaticamente dallo script e serve solo per salvare l&rsquo;ip corrente."><meta property="og:type" content="article"><meta property="og:url" content="https://simon020286.github.io/posts/update-ddns/"><meta property="article:published_time" content="2020-09-17T16:59:50+02:00"><meta property="article:modified_time" content="2020-09-17T16:59:50+02:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Update Ddns"><meta name=twitter:description content="Eccoci qui con il primo vero post di questo blog.
Oggi ci dedicheremo all&rsquo;aggiornamento automatico dell&rsquo;ip del proprio server su alcuni servizi DDNS.
Per fare ciò esistono innumerevoli tool, ma perché utilizzare qualcosa di già fatto quando puoi imparare qualcosa di nuovo?
In questo periodo mi sto dilettando con gli script bash, quindi ho deciso di seguire questa strada. Il progetto è composto da soli due file, lo script vero e proprio e il file di configurazione, ad essere precisi ce ne sarebbe un terzo, ma viene creato automaticamente dallo script e serve solo per salvare l&rsquo;ip corrente."><link rel=stylesheet href=https://simon020286.github.io/css/style-dark.css><!--[if lt IE 9]><script src=https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js></script><script src=https://oss.maxcdn.com/respond/1.4.2/respond.min.js></script><![endif]--><link rel=icon type=image/png href=https://simon020286.github.io/images/favicon.ico></head><body class="max-width mx-auto px3 ltr"><div class="content index py4"><div id=header-post><a id=menu-icon href=#><i class="fas fa-bars fa-lg"></i></a><a id=menu-icon-tablet href=#><i class="fas fa-bars fa-lg"></i></a><a id=top-icon-tablet href=# onclick="$('html, body').animate({scrollTop:0},'fast');" style=display:none><i class="fas fa-chevron-up fa-lg"></i></a><span id=menu><span id=nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li></ul></span><br><span id=actions><ul><li><a class=icon href=https://simon020286.github.io/posts/first-post/><i class="fas fa-chevron-left" aria-hidden=true onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li><li><a class=icon href=https://simon020286.github.io/posts/2020-11-04-traefik-intro/><i class="fas fa-chevron-right" aria-hidden=true onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li><li><a class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up" aria-hidden=true onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li><li><a class=icon href=#><i class="fas fa-share-alt" aria-hidden=true onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li></ul><span id=i-prev class=info style=display:none>Previous post</span>
<span id=i-next class=info style=display:none>Next post</span>
<span id=i-top class=info style=display:none>Back to top</span>
<span id=i-share class=info style=display:none>Share post</span></span><br><div id=share style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f"><i class="fab fa-facebook" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&text=Update%20Ddns"><i class="fab fa-twitter" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&title=Update%20Ddns"><i class="fab fa-linkedin" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&is_video=false&description=Update%20Ddns"><i class="fab fa-pinterest" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Update%20Ddns&body=Check out this article: https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f"><i class="fas fa-envelope" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&title=Update%20Ddns"><i class="fab fa-get-pocket" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&title=Update%20Ddns"><i class="fab fa-reddit" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&title=Update%20Ddns"><i class="fab fa-stumbleupon" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&title=Update%20Ddns"><i class="fab fa-digg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&name=Update%20Ddns&description=Eccoci%20qui%20con%20il%20primo%20vero%20post%20di%20questo%20blog.%0aOggi%20ci%20dedicheremo%20all%26rsquo%3baggiornamento%20automatico%20dell%26rsquo%3bip%20del%20proprio%20server%20su%20alcuni%20servizi%20DDNS.%0aPer%20fare%20ci%c3%b2%20esistono%20innumerevoli%20tool%2c%20ma%20perch%c3%a9%20utilizzare%20qualcosa%20di%20gi%c3%a0%20fatto%20quando%20puoi%20imparare%20qualcosa%20di%20nuovo%3f%0aIn%20questo%20periodo%20mi%20sto%20dilettando%20con%20gli%20script%20bash%2c%20quindi%20ho%20deciso%20di%20seguire%20questa%20strada.%20Il%20progetto%20%c3%a8%20composto%20da%20soli%20due%20file%2c%20lo%20script%20vero%20e%20proprio%20e%20il%20file%20di%20configurazione%2c%20ad%20essere%20precisi%20ce%20ne%20sarebbe%20un%20terzo%2c%20ma%20viene%20creato%20automaticamente%20dallo%20script%20e%20serve%20solo%20per%20salvare%20l%26rsquo%3bip%20corrente."><i class="fab fa-tumblr" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&t=Update%20Ddns"><i class="fab fa-hacker-news" aria-hidden=true></i></a></li></ul></div><div id=toc><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#no-ip>No-Ip</a></li><li><a href=#duckdns>DuckDns</a></li></ul></li></ul></li></ul></nav></div></span></div><article class=post itemscope itemtype=http://schema.org/BlogPosting><header><h1 class=posttitle itemprop="name headline">Update Ddns</h1><div class=meta><div class=postdate><time datetime="2020-09-17 16:59:50 &#43;0200 &#43;0200" itemprop=datePublished>17-09-2020</time></div><div class=article-tag><i class="fas fa-tag"></i><a class=tag-link href=/tags/bash rel=tag>bash</a>
,
<a class=tag-link href=/tags/ddns rel=tag>ddns</a>
,
<a class=tag-link href=/tags/self-hosted rel=tag>self-hosted</a></div></div></header><div class=content itemprop=articleBody><p>Eccoci qui con il primo vero post di questo blog.<br>Oggi ci dedicheremo all&rsquo;aggiornamento automatico dell&rsquo;ip del proprio server su alcuni servizi DDNS.<br>Per fare ciò esistono innumerevoli tool, ma perché utilizzare qualcosa di già fatto quando puoi imparare qualcosa di nuovo?<br>In questo periodo mi sto dilettando con gli script bash, quindi ho deciso di seguire questa strada. Il progetto è composto da soli due file, lo script vero e proprio e il file di configurazione, ad essere precisi ce ne sarebbe un terzo, ma viene creato automaticamente dallo script e serve solo per salvare l&rsquo;ip corrente.<br>Come detto nel post di benvenuto, questo non vuole essere un blog di tutorial, ma la condivisione delle mie esperienze, quindi vi illustrerò come aggiornare gli ip sui due servizi che sto utilizzando al momento.<br>+ <a href=http://no-ip.com>No-Ip</a>
+ <a href=https://www.duckdns.org/>Duck DNS</a></p><p>No-Ip è stato il primo servizio che ho utilizzato, offre molte opzioni e molti sotto servizi. Nella versione free è possibile registrare solo 3 hostname ed è necessario rinnovarli ogni 30 giorni.<br>Duck DNS invece è molto più scarno, permette la registrazione di domini che terminano solo con <code>.duckdns.org</code>, ma è possibile registrare fino a 5 nomi e non richiede il rinnovo.<br>Passiamo allo script.<br>La parte più complicata è parsare il file di configurazione, ma per fortuna, ovviamente, esiste qualcosa di già fatto.
Ho utilizzato il metodo descritto in <a href=https://blog.sleeplessbeastie.eu/2019/11/11/how-to-parse-ini-configuration-file-using-bash/>questo articolo</a>.<br>Non sto a spiegare come avviene il parse della configurazione perché non è oggetto di questo post e il tutto viene già spiegato nell&rsquo;articolo linkato. Proseguiamo quindi con la parte da me creata.</p><pre><code class=language-bash>GetINISections $1

DIRECTORY=$(cd `dirname $0` &amp;&amp; pwd)

filename=&quot;$DIRECTORY/currentip.txt&quot;

if [[ ! -e $filename ]]; then
    touch $filename
fi

oldip=$(cat $filename)
currentip=$(curl -s 'http://ip1.dynupdate.no-ip.com/')

if [ &quot;$2&quot; == &quot;--force&quot; ]; then
  oldip=&quot;&quot; 
fi
</code></pre><p>La prima riga dello script va proprio a leggere il file di configurazione, che vedremo in seguito, il cui path viene passato come primo parametro allo script.<br>Nelle righe successive viene:<br>1) inizializzato il path del file in cui viene salvato l&rsquo;ultimo ip
1) letto l&rsquo;ip dal file
1) recuperato l&rsquo;ip corrente tramite l&rsquo;api messa a disposizione da no-ip e salvato nella variabile <code>currentip</code>
1) se il secondo parametro passato allo script è <code>--force</code>, viene svuotato il valore dell&rsquo;ultimo ip.<br>Vedremo in seguito il perché.</p><h3 id=no-ip>No-Ip</h3><p>Per questo servizio è necessario utilizzare username e password utilizzati per loggarsi al sito e gli hostname che si vogliono aggiornare.
Questi se più di uno, basta separarli da virgola. E&rsquo; anche possibile utilizzare i gruppi presenti su no-ip, passando il nome del gruppo verranno aggiornati automaticamente tutti gli hostname che ne fanno parte.</p><pre><code class=language-ini>[NoIp]
domains=&lt;NOME_DOMINIO&gt;
username=&lt;USERNAME&gt;
password=&lt;PASSWORD&gt;
</code></pre><p>Nello script bash viene semplicemente chiamata l&rsquo;api, tramite curl, messa a disposizione da no-ip, passando i dati necessari.
Il metodo effettua la chiamata solo se è presente una dominio per no-ip nel file di configurazione.</p><pre><code class=language-bash>updateNoIp() {
  if [ -n &quot;${configuration_noip[&quot;domains&quot;]}&quot; ]; then
    domains=${configuration_noip[&quot;domains&quot;]}
    username=${configuration_noip[&quot;username&quot;]}
    password=${configuration_noip[&quot;password&quot;]}
    urlnoip=&quot;https://dynupdate.no-ip.com/nic/update?hostname=$domains&amp;myip=$currentip&quot;
    echo $(curl -s --user $username:$password $urlnoip)
  fi
}
</code></pre><h3 id=duckdns>DuckDns</h3><p>Per questo servizio è sufficiente recuperare il token presente nella pagina principale una volta loggati e gli hostname che si vogliono aggiornare.
Trovate un esempio qui sotto.</p><p><img src=https://res.cloudinary.com/drg2utgxr/image/upload/v1600434391/posts/update-ddns/duckdns_01.png alt=Duckdns></p><p>Recuperati questi dati il file di configurazione va compilato come segue.
Se gli hostname da aggiornare sono più di uno basta scriverli separati da virgola.</p><pre><code class=language-ini>[DuckDns]
domains=&lt;NOME_DOMINIO&gt;
token=&lt;TOKEN&gt;
</code></pre><p>Anche in questo caso è sufficiente chiamare l&rsquo;api fornita.</p><pre><code class=language-bash>updateDuckDns() {
  if [ -n &quot;${configuration_duckduck[&quot;domains&quot;]}&quot; ]; then
    domains=${configuration_duckduck[&quot;domains&quot;]}
    token=${configuration_duckduck[&quot;token&quot;]}
    urlduckduck=&quot;https://www.duckdns.org/update?domains=$domains&amp;token=$token&amp;ip=$currentip&quot;
    echo $(curl -s $urlduckduck)
  fi
}
</code></pre><p>L&rsquo;ultima parte dello script è la parte che gestisce il tutto.<br>Se l&rsquo;ip letto dal file è diverso da quello attuale vengono chiamate le singole funzioni per i servizi e aggiornato l&rsquo;ip nel file (rig. 83), altrimenti non viene eseguita nessuna operazione.
Passando allo script come secondo parametro <code>--force</code>, come detto in precedenza, viene svuotato il valore di <code>$oldip</code> quindi l&rsquo;aggiornamento verrà fatto indipendentemente dal valore letto dal file.</p><pre><code class=language-bash>if [ &quot;$oldip&quot; != &quot;$currentip&quot; ]; then
  updateNoIp
  updateDuckDns
  echo $currentip &gt; $filename
else
  echo 'Not changed'
fi
</code></pre><p>Questo script lo utilizzo sul mio nas di casa su cui girano alcuni servizi accessibili da internet, per richiamarlo l&rsquo;ho schedulato ogni 30 minuti con cron.<br>E con questo è tutto, al momento non utilizzo altri servizi per cui il mio script si ferma qui. Suppongo che funzionino più o meno allo stesso modo, quindi non dovrebbe essere complicato integrarne altri.<br>Il codice è disponibile a questo <a href=https://github.com/simon020286/update-ddns>repository</a> di GitHub, siete liberi di proporre modifiche e aggiunte.</p><p>Buon divertimento</p></div></article><div class=blog-post-comments><div id=disqus_thread><script type=text/javascript>(function(){var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='devdaddy-1';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div><div id=footer-post-container><div id=footer-post><div id=nav-footer style=display:none><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li></ul></div><div id=toc-footer style=display:none><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#no-ip>No-Ip</a></li><li><a href=#duckdns>DuckDns</a></li></ul></li></ul></li></ul></nav></div><div id=share-footer style=display:none><ul><li><a class=icon href="http://www.facebook.com/sharer.php?u=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f"><i class="fab fa-facebook fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://twitter.com/share?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&text=Update%20Ddns"><i class="fab fa-twitter fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.linkedin.com/shareArticle?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&title=Update%20Ddns"><i class="fab fa-linkedin fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://pinterest.com/pin/create/bookmarklet/?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&is_video=false&description=Update%20Ddns"><i class="fab fa-pinterest fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="mailto:?subject=Update%20Ddns&body=Check out this article: https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f"><i class="fas fa-envelope fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://getpocket.com/save?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&title=Update%20Ddns"><i class="fab fa-get-pocket fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://reddit.com/submit?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&title=Update%20Ddns"><i class="fab fa-reddit fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.stumbleupon.com/submit?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&title=Update%20Ddns"><i class="fab fa-stumbleupon fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://digg.com/submit?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&title=Update%20Ddns"><i class="fab fa-digg fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="http://www.tumblr.com/share/link?url=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&name=Update%20Ddns&description=Eccoci%20qui%20con%20il%20primo%20vero%20post%20di%20questo%20blog.%0aOggi%20ci%20dedicheremo%20all%26rsquo%3baggiornamento%20automatico%20dell%26rsquo%3bip%20del%20proprio%20server%20su%20alcuni%20servizi%20DDNS.%0aPer%20fare%20ci%c3%b2%20esistono%20innumerevoli%20tool%2c%20ma%20perch%c3%a9%20utilizzare%20qualcosa%20di%20gi%c3%a0%20fatto%20quando%20puoi%20imparare%20qualcosa%20di%20nuovo%3f%0aIn%20questo%20periodo%20mi%20sto%20dilettando%20con%20gli%20script%20bash%2c%20quindi%20ho%20deciso%20di%20seguire%20questa%20strada.%20Il%20progetto%20%c3%a8%20composto%20da%20soli%20due%20file%2c%20lo%20script%20vero%20e%20proprio%20e%20il%20file%20di%20configurazione%2c%20ad%20essere%20precisi%20ce%20ne%20sarebbe%20un%20terzo%2c%20ma%20viene%20creato%20automaticamente%20dallo%20script%20e%20serve%20solo%20per%20salvare%20l%26rsquo%3bip%20corrente."><i class="fab fa-tumblr fa-lg" aria-hidden=true></i></a></li><li><a class=icon href="https://news.ycombinator.com/submitlink?u=https%3a%2f%2fsimon020286.github.io%2fposts%2fupdate-ddns%2f&t=Update%20Ddns"><i class="fab fa-hacker-news fa-lg" aria-hidden=true></i></a></li></ul></div><div id=actions-footer><a id=menu class=icon href=# onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden=true></i>Menu</a>
<a id=toc class=icon href=# onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden=true></i>TOC</a>
<a id=share class=icon href=# onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden=true></i>share</a>
<a id=top style=display:none class=icon href=# onclick="$('html, body').animate({scrollTop:0},'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden=true></i>Top</a></div></div></div><footer id=footer><div class=footer-left>Copyright &copy; 2020 Dev Daddy</div><div class=footer-right><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>All posts</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></footer></div></body><link rel=stylesheet href=/lib/font-awesome/css/all.min.css><script src=/lib/jquery/jquery.min.js></script><script src=/js/main.js></script></html>